---
title: "Data Introduction May 2021"
author: "Ana Miller-ter Kuile"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

Thanks so much for agreeing to help with this project! I honestly have no idea as to the level ("quality/novelty") of this project but I think it could be a good fit for a specific journal (e.g. Food Webs) or a mid-tier ecology journal (Biology Letters)? Anyway - as you look at the data maybe you can provide some insight on how to write this and for where! 

# The questions

This project would be building off previous work on Palmyra examining how ecosystem productivity and size influences food chain length using stable isotopes (Young et al. 2013). That study found that islet productivity (driven by seabird nutrient additions) shaped food chain length while islet size did not. The factors of islet size and productivity do not covary in this system.

What we can add with this dataset is some idea of the mechanisms by which food chain length increases because we have several datasets for those same top predators from that study (*Heteropoda venatoria*) at the individual level, including body size, stable isotope values ($\delta^{15}N$ and $\delta^{13}C$), and diet DNA metabarcoding data for a subset of individuals. 

The questions I have thought of are along this vein:

While it has been established that habitat productivity can increase food chain length (Young et al. 2013 paper and other similar literature), there are multiple mechanisms by which this could occur.

1.	Predators may shift to new resources at higher trophic levels (niche size stays the same but shifts location)

2.	Predators may become more general and feed across broader trophic groups (niche size expands beyond its current span)

Multiple lines of evidence may help us understand how these niche shifts take place, or maybe their consequences (the cause-effect of body size-niche space is a little... I haven't come up with a good way to think about that yet):

1.	Predators may become larger in size to access different resource pools or in response to more available resources at higher productivity.

2.	We may be able to detect diet composition shifts alongside shifts in niche space (either expansions or shifts in space) that explain how predators respond to more productive environments. 

*An aside and/or alternative framing: H. venatoria is an introduced predator species and so the framing/conclusions could be shaped by the species characteristics (e.g. diet/habitat generalism) that have allowed this species to be successful in new environments.*

# The data

As I mentioned above, we have multiple datasets to use for this project:

1. Stable isotope data ($\delta^{15}N$ and $\delta^{13}C$) from 160 predator individuals from three separate sampling years (2009, 2012, and 2015) across 12 islets (6 high, 6 low productivity; 6 big, 6 small in area)

2. Body size data (length and mass) for these same predator individuals

3. DNA diet data (at Order level, so we could have more data) from 34 individuals (all from 2015) constituting 68 predator-prey pairs from five islets (3 high, 2 low productivity; 3 big, 2 small in area)

Several of you helped collect these spiders, but for context: We collected these spiders opportunistically at night using eye shine. They represent the first 10-15 individuals observed on each islet during each sampling period. Importantly, as a result, while they do not represent the full size range of this species, they do represent the size distribution of those individuals of this species that are actively hunting in a similar habitat. (The juveniles of this species, just anecdotally, are often found in the canopy so there could be some really cool stage structure habitat partitioning for this species, but that's another project...)

```{r, include = FALSE}
library(here)

source(here("code", "source_isotopes.R"))

source(here("code", "source_DNA.R"))
```

## 0. The environmental data

Palmyra Atoll is comprised of ~20 smaller patches of land ('islets') that vary in size and productivity (driven by seabird nutrient addition). We selected islets for this study on the extreme ends of the productivity and size spectrums.

```{r}
islands2 <- islands %>%
  mutate(dataset = case_when(Island %in% c("Aviation",
                                            "Castor", 
                                            "Dudley",
                                            "Frigate",
                                            "Kaula",
                                            "Lost",
                                            "Paradise",
                                           "Eastern", 
                                            "Fern",
                                            "Holei",
                                            "Leslie",
                                            "Sand") ~ "Data",
                             TRUE ~ "No data")) 

islands3 <- islands %>%
  filter(Island %in% c("Aviation",
                                            "Castor", 
                                            "Dudley",
                                            "Frigate",
                                            "Kaula",
                                            "Lost",
                                            "Paradise",
                                           "Eastern", 
                                            "Fern",
                                            "Holei",
                                            "Leslie",
                                            "Sand"))
```


Islet area ranges from `r min(islands$Island_Area)` to `r max(islands$Island_Area)`$m^2$ and islet productivity ranges from `r min(islands$Island_prod, na.rm = T)` to `r max(islands$Island_prod, na.rm =T)`$gN/m^2/day$ (determined from a controlled greenhouse plant growth experiment with soils from each islet from Palmyra, Young et al. 2013).

We selected islets to sample on the high and low ends of the size and productivity spectra. In the following two figures, the blue bars represent the islets we sampled and the grey bars represent the distribution of all islets in size and productivity. 

```{r}
ggplot(islands, aes(x = Island_Area)) +
  geom_histogram(color = "black") +
  geom_histogram(data = islands3, aes(x = Island_Area), fill = "lightblue",color = "black", alpha = 0.4) +
  scale_x_log10() +
  theme_bw()

```


```{r}
ggplot(islands, aes(x = Island_prod)) +
  geom_histogram(color = "black") +
  geom_histogram(data = islands3, aes(x = Island_prod), fill = "lightblue",color = "black", alpha = 0.4) +
  scale_x_log10() +
  theme_bw()
```

## 1. How does niche space shift with productivity and islet size?

This is just a visualization but I'll likely do some combination of the most recent methods for isotope niche space (e.g. Eckrich et al. 2019), which include both a standard ellipse area (Layman et al. 2012) and also an estimate of kernel density (better captures the shape and clustering of individuals in the population). *I have corrected the $d^{15}N$ values in the following two plots by an average isotope baseline for each islet (an average of plant isotope values) following the approach from Nigro et al. (2017).*

```{r}
spider_iso %>%
  mutate(Island = factor(Island, 
                         levels = c("Aviation", "Castor", "Fern",
                                    "Holei","Kaula", "Paradise", 
                                    "Dudley", "Eastern", "Frigate",
                                    "Leslie", "Lost", "Sand"))) %>%
  filter(!is.na(prod_level)) %>%
  #filter(Year != 2009) %>%
  ggplot(aes(x = d13C, y = d15N_c, level = prod_level)) +
  geom_point(aes(shape = prod_level, color = Island), size = 4) +
  labs(x = expression({delta}^13*C~ ('\u2030')), 
       y = expression({delta}^15*N~ ('\u2030'))) +
  #stat_ellipse(size = 1) +
  #stat_ellipse(aes(color = Island), linetype = "dashed", size = 1) +
  scale_color_manual(values = c("#2D1A03", "#543005", 
                                "#8c510a","#bf812d",
                                "#dfc27d", "#f6e8c3", "#c7eae5",
                                "#80cdc1", "#35978f", "#01665e", 
                                "#003c30", "#001511")) +
  theme_bw() +
  facet_wrap(~size_level)

```

Just getting started on this exploration but it is looking like the niche space of every population is staying the same (space occupied by each population), but that the location of that niche is shifting in niche space. Specifically, with an increase in $\delta^{15}N$ and *maybe* a slight shift in $\delta^{13}C$ on high productivity islets, with maybe a bigger shift happening on big versus small islets. In isotope terms, increases in $\delta^{15}N$ correspond to increases in trophic position while shifts in $\delta^{13}C$ correspond to shifts in resource pools. On Palmyra, this $\delta^{13}C$ has possible pools of either terrestrial or marine inputs. 

For reference, here are the common 'resource pool' isotope values for Palmyra, broken up by whether they are terrestrial (plants), marine algae, or guano. 

```{r}
plant_iso %>%
  filter(!Species %in% c("Asplenium", "Grass")) %>%
  mutate(type = case_when(Species %in% c("Algae", "homog-cladoph",
                                            "turf algae-homo",
                                            "turf algae-v") ~ "Algae",
                          Species %in% c("Cocos", "Phymatosorus",
                                         "Pisonia", "Scaevola",
                                         "Tournefortia") ~ "Terrestrial",
                             TRUE ~ Species)) %>%
ggplot(aes(x = d13C, y = d15N, color = type, shape = type)) +
  geom_point(size = 3) +
  labs(x = expression({delta}^13*C~ ('\u2030')), 
       y = expression({delta}^15*N~ ('\u2030'))) +
  scale_color_manual(values = c("#969696", "#737373", "#525252")) +
  theme_bw() 
```


## 2. How does body size shift with productivity and islet size?

```{r}
spider_iso %>%
  mutate(mass_mg = Mass_g*100) %>%
ggplot(aes(x = prod_level, y = mass_mg, color = size_level)) +
  geom_boxplot(size = 1) +
  geom_point(aes(color = size_level), 
             position=position_jitterdodge(), alpha = 0.6) +
  labs(x = "Productivity level", y = "Mass (mg)") +
  scale_color_manual(values = c("#525252", "#969696")) +
  theme_bw()
```


```{r}
spider_iso %>%
ggplot(aes(x = prod_level, y = Length_mm, color = size_level)) +
  geom_boxplot(size = 1) +
  geom_point(aes(color = size_level), 
             position=position_jitterdodge(), alpha = 0.6) +
  labs(x = "Productivity level", y = "Length (mm)") +
  scale_color_manual(values = c("#525252", "#969696")) +
  theme_bw()
```

*Maybe* some shifts in body size with increases on high productivity islets with maybe a big/small interaction?

### 2.1 Do larger predators have different isotopic positions?

*Note: in the next two figures the x-axis is scaled differently for high and low-productivity islets to show the spread of data for each.*

```{r}
spider_iso %>%
  mutate(Mass_mg = 100*Mass_g) %>%
ggplot(aes(x = Mass_mg, y = d15N_c, color = size_level)) +
  geom_point() +
  geom_smooth(method = "lm", se = F) +
  scale_color_manual(values = c("#525252", "#969696")) +
  theme_bw() +
  labs(x = "Mass (mg)", y = expression({delta}^15*N~ ('\u2030'))) +
  facet_wrap(~prod_level, scales = "free_x")
```

```{r}
spider_iso %>%
  mutate(Mass_mg = 100*Mass_g) %>%
  ggplot(aes(x = Mass_mg, y = d13C, color = size_level)) +
  geom_point() +
  geom_smooth(method = "lm", se = F) +
  scale_color_manual(values = c("#525252", "#969696")) +
  theme_bw() +
  labs(x = "Mass (mg)", y = expression({delta}^13*C~ ('\u2030'))) +
  facet_wrap(~prod_level, scales = "free_x")
```

It doesn't seem like either isotope value is really shifting with body size? There seems to be a "blob" of isotope values in the smaller sizes and maybe some more consistent trophic positioning (at least for $\delta^{15}N$) across larger individuals, maybe suggesting stage-structured generalism vs. specialism? 

## 3. How does DNA diet shift with productivity and size?


```{r}
ggplot(islet_prey2, aes(x = Order, y = percent, fill = Island)) +
  geom_col(position = position_dodge2(width = 0.9, preserve = "single")) +
  theme_bw() +
  coord_flip() +
  labs(x = "Frequency (percentage of samples)", y = "Prey Order") +
  scale_fill_manual(values = c("#80cdc1", "#8c510a", "#bf812d", "#01665e", "#001511")) +
  facet_wrap(size_level~prod_level)
```

I'm not sure with these DNA data we will be able to do any islet size*productivity tests given that there are only 5 islets. Rather, perhaps it would be better to inform any exploration of these data on the results of the isotope and body size results and perhaps these data would remain a little more qualitative? Or - only selecting either islet size or productivity depending on the results of the above analyses. Also - I'm sure there could be some interesting composition analyses here - An, I could use your brilliant multivariate brain! 

In this graph I am struck by how similar their most common diet items are across islets (cockroaches: Blattodea, crickets/katydids/grasshoppers: Orthoptera, earwigs: Dermaptera) despite apparent differences in isotope values. 

Table of sample sizes (number of interactions) per islet

```{r}
DNA_iso %>%
  group_by(Island, prod_level, size_level) %>%
  tally()
```

Table of interaction frequencies by islet

```{r}
islet_prey2
```

# Next steps!

Actually running some statistics on isotope and body size data...

How does DNA diet composition shift across islets (could use your insights here, An!)?

If DNA diet composition isn't shifting much, why is isotope niche shifting? Can I answer this question with this dataset?

Directionality of size-resource hypothesis - any ideas on how to think about the body size data?

How interesting is this? Would it benefit from other datasets? 

How novel/where do you think this would fit in a journal? There are quite a few isotope + DNA diet studies that I've seen with some sleuthing; however, it doesn't seem that many of them are going beyond "documenting diet" of a species of interest - though see the Kennedy et al. 2019 paper linked below for one that I think asks some cool evolutionary and ecological questions. 

# Thoughts/notes from convos

Dan: 
Pull data from prey items from the Palmyra data and biplot their corrected isotope values too

-	Maybe increases in food chain length happen at lower trophic levels, not the top trophic level…

Common prey items for which we have isotope data:
Diptera
Hempitera
Lepidoptera
Araneae
Orthoptera

Could I also incorporate the DNA data from more spiders + the potential prey items I picked up somehow to answer these questions? Maybe top predators aren’t shifting their diets all that much but food chain length is increasing in the middle of the food web?

Austen: 
compare isotope and DNA dissimilarity via Mantel test? 

dist(isotopes) ~ dist(diet) + dist(spider_phys) 

# References and relevant papers I like

Eckrich, C. A., Albeke, S. E., Flaherty, E. A., Bowyer, R. T., & Ben-David, M. (2020). rKIN: Kernel-based method for estimating isotopic niche size and overlap. Journal of Animal Ecology, 89(3), 757–771. [doi: 10.1111/1365-2656.13159](https://besjournals.onlinelibrary.wiley.com/doi/abs/10.1111/1365-2656.13159)

   - Newest methods in determining isotopic niche space.

Eitzinger, B., Abrego, N., Gravel, D., Huotari, T., Vesterinen, E. J., & Roslin, T. (2019). Assessing changes in arthropod predator–prey interactions through DNA-based gut content analysis—variable environment, stable diet. Molecular Ecology, 28(2), 266–280. [doi: 10.1111/mec.14872](https://onlinelibrary.wiley.com/doi/abs/10.1111/mec.14872)

  - Documented diet of a spider using DNA across environments, showing that composition stayed the same despite very different environmental conditions.

Kennedy, S., Lim, J. Y., Clavel, J., Krehenwinkel, H., & Gillespie, R. G. (2019). Spider webs, stable isotopes and molecular gut content analysis: Multiple lines of evidence support trophic niche differentiation in a community of Hawaiian spiders. Functional Ecology, 33(9), 1722–1733. [doi: 10.1111/1365-2435.13361](https://besjournals.onlinelibrary.wiley.com/doi/abs/10.1111/1365-2435.13361)

  - Looked at a radiation of *Tetragnatha* (genus) spiders in Hawai'i where half of the species have a different hunting strategy from the other half and showed cool shifts in isotope and DNA diet (at Order leve) across these two halves of the clade. 

Layman, C. A., Araujo, M. S., Boucek, R., Hammerschlag-Peyer, C. M., Harrison, E., Jud, Z. R., … Bearhop, S. (2012). Applying stable isotopes to examine food-web structure: An overview of analytical tools. Biological Reviews, 87(3), 545–562. [doi: 10.1111/j.1469-185X.2011.00208.x](https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1469-185X.2011.00208.x)

  - The foundational isotopic niche space paper, though I think the rKIN methods are a bit more relevant now.

Nigro, K. M., Hathaway, S. A., Wegmann, A. S., Miller-ter Kuile, A., Fisher, R. N., & Young, H. S. (2017). Stable isotope analysis as an early monitoring tool for community-scale effects of rat eradication. Restoration Ecology, 25(6), 1015–1025. [doi: 10.1111/rec.12511](https://onlinelibrary.wiley.com/doi/abs/10.1111/rec.12511)

  - A paper from Palmyra on land crab isotope shifts pre-post rat eradication.

Young, H. S., McCauley, D. J., Dunbar, R. B., Hutson, M. S., Ter-Kuile, A. M., & Dirzo, R. (2013). The roles of productivity and ecosystem size in determining food chain length in tropical terrestrial ecosystems. Ecology, 94(3), 692–701. [doi: 10.1890/12-0729.1](https://esajournals.onlinelibrary.wiley.com/doi/abs/10.1890/12-0729.1)

  - The paper from Palmyra showing shifts in trophic position of predators using stable isotopes with increased islet productivity, but not islet size. This paper used an pooled value of each predator species per islet rather than individual-level diet or isotope data. 
